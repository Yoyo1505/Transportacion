<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Cotizaciones | TAE Transportación</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 15px; background: #fff; color: #333; }
        .container { max-width: 1100px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .header { background: #0d1120; color: #fff; text-align: center; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 2rem; text-transform: uppercase; }
        h2 { color: #0d1120; margin: 1.5rem 0 1rem; }
        .form-section { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #0d1120; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        button { background: #0d1120; color: #fff; border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: 600; margin: 5px; }
        button:hover { background: #1a2440; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th { background: #0d1120; color: #fff; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        .price { text-align: right; }
        .remove-btn { background: #e0e0e0; color: #333; padding: 6px 12px; font-size: 0.9rem; }
        .remove-btn:hover { background: #ccc; }
        .item-controls { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
        #item-select { flex: 1; min-width: 220px; }
        #total { font-size: 1.8rem; font-weight: bold; color: #c9c197; }
        .total-section { background: #0d1120; color: #fff; padding: 20px; border-radius: 8px; }
        .button-group { text-align: center; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TAE Transportación</h1>
            <p>Generador de Cotizaciones</p>
        </div>

        <div class="form-section">
            <h2>Datos del Cliente</h2>
            <label for="folio">Folio:</label><input id="folio" placeholder="COT-2026-XXX">
            <label for="cliente">Cliente:</label><input id="cliente">
            <label for="ciudad">Ciudad:</label><input id="ciudad">
            <label for="telefono">Teléfono:</label><input id="telefono">
            <label for="email">Email:</label><input id="email">
        </div>

        <div class="form-section">
            <h2>Ítems de Cotización</h2>
            <div class="item-controls">
                <select id="item-select">
                    <option value="">Selecciona un ítem...</option>
                    <option value="AUTOBUS 45 PLAZAS">AUTOBUS 45 PLAZAS</option>
                    <option value="CAMIONETA CARGA">CAMIONETA CARGA</option>
                    <option value="CAMIONETA VAN">CAMIONETA VAN</option>
                    <option value="COMIDAS DEL OPERADOR">COMIDAS DEL OPERADOR</option>
                    <option value="COORDINADOR">COORDINADOR</option>
                    <option value="DERECHOS DE PISO">DERECHOS DE PISO</option>
                    <option value="HORAS EXTRA">HORAS EXTRA</option>
                    <option value="HOSPEDAJE">HOSPEDAJE</option>
                    <option value="MINIBUS 31 PLAZAS">MINIBUS 31 PLAZAS</option>
                    <option value="PARKING">PARKING</option>
                    <option value="SEDAN">SEDAN</option>
                    <option value="SEDAN AIFA">SEDAN AIFA</option>
                    <option value="SEDAN TOLUCA">SEDAN TOLUCA</option>
                    <option value="SPRINTER">SPRINTER</option>
                    <option value="SPRINTER AIFA">SPRINTER AIFA</option>
                    <option value="SUBURBAN">SUBURBAN</option>
                    <option value="SUBURBAN ADVANCE">SUBURBAN ADVANCE</option>
                    <option value="SUBURBAN BLINDADA NIVEL 3">SUBURBAN BLINDADA NIVEL 3</option>
                    <option value="SUBURBAN HIGH COUNTRY">SUBURBAN HIGH COUNTRY</option>
                    <option value="SUBURBAN AIFA">SUBURBAN AIFA</option>
                    <option value="SUBURBAN TOLUCA">SUBURBAN TOLUCA</option>
                    <option value="TOYOTA AIFA">TOYOTA AIFA</option>
                    <option value="TOYOTA HIACE">TOYOTA HIACE</option>
                    <option value="TOYOTA SPRINTER 20 PLAZAS">TOYOTA SPRINTER 20 PLAZAS</option>
                    <option value="TOYOTA TOLUCA">TOYOTA TOLUCA</option>
                    <option value="TRAMO CARRETERO">TRAMO CARRETERO</option>
                    <option value="VAN DE CARGA">VAN DE CARGA</option>
                    <option value="VIATICOS">VIATICOS</option>
                </select>
                <button id="add-item-btn">Agregar Ítem</button>
            </div>
            <label for="notes">Notas:</label><textarea id="notes" rows="3" placeholder="Anotaciones adicionales..."></textarea>

            <table id="items-table">
                <thead>
                    <tr>
                        <th>Cant.</th>
                        <th>Concepto</th>
                        <th>Vehículo/Servicio</th>
                        <th>P. Unitario</th>
                        <th>Total</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="total-section">
            <label for="tax">Impuestos (%):</label><input type="number" id="tax" value="16" min="0" step="0.1" style="width:100px;">
            <strong>Total: <span id="total">$0.00</span></strong>
        </div>

        <div class="button-group">
            <button onclick="generatePDF()">Generar PDF</button>
            <button onclick="window.print()">Imprimir</button>
            <button onclick="clearForm()">Limpiar</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;
        const itemsBody = document.querySelector('#items-table tbody');
        const itemSelect = document.getElementById('item-select');
        const addBtn = document.getElementById('add-item-btn');
        const taxInput = document.getElementById('tax');
        const totalSpan = document.getElementById('total');
        const folio = document.getElementById('folio');
        const cliente = document.getElementById('cliente');
        const ciudad = document.getElementById('ciudad');
        const telefono = document.getElementById('telefono');
        const email = document.getElementById('email');
        const notes = document.getElementById('notes');

        const preciosSugeridos = {
            "AUTOBUS 45 PLAZAS": 18500, "MINIBUS 31 PLAZAS": 12500, "SPRINTER": 9500, "SPRINTER AIFA": 10500,
            "TOYOTA SPRINTER 20 PLAZAS": 8800, "SUBURBAN": 4800, "SUBURBAN AIFA": 5200, "SUBURBAN TOLUCA": 5500,
            "SUBURBAN HIGH COUNTRY": 6500, "SUBURBAN BLINDADA NIVEL 3": 12500, "SUBURBAN ADVANCE": 5800,
            "SEDAN": 3200, "SEDAN AIFA": 3800, "SEDAN TOLUCA": 4000, "TOYOTA AIFA": 4200, "TOYOTA TOLUCA": 4500,
            "CAMIONETA VAN": 3800, "VAN DE CARGA": 4500, "CAMIONETA CARGA": 5200, "HOSPEDAJE": 1800,
            "VIATICOS": 1200, "COMIDAS DEL OPERADOR": 450, "COORDINADOR": 2500, "DERECHOS DE PISO": 1800,
            "PARKING": 800, "HORAS EXTRA": 650, "TRAMO CARRETERO": 0
        };

        addBtn.addEventListener('click', () => {
            const selected = itemSelect.value.trim();
            if (!selected) return alert('Selecciona un ítem primero.');
            const precio = preciosSugeridos[selected] || 0;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="number" class="qty" value="1" min="1" style="width:60px;"></td>
                <td>Servicio de Transportación Ejecutiva</td>
                <td>${selected}</td>
                <td><input type="number" class="unit-price" value="${precio}" step="0.01" style="width:110px;"></td>
                <td class="row-total price">$0.00</td>
                <td><button class="remove-btn">Eliminar</button></td>
            `;
            itemsBody.appendChild(row);

            const qtyInput = row.querySelector('.qty');
            const priceInput = row.querySelector('.unit-price');
            const totalCell = row.querySelector('.row-total');

            const updateRow = () => {
                const q = parseFloat(qtyInput.value) || 0;
                const p = parseFloat(priceInput.value) || 0;
                const t = q * p;
                totalCell.textContent = `$${t.toLocaleString('es-MX', {minimumFractionDigits:2})}`;
                updateTotal();
            };

            qtyInput.addEventListener('input', updateRow);
            priceInput.addEventListener('input', updateRow);
            row.querySelector('.remove-btn').addEventListener('click', () => { row.remove(); updateTotal(); });
            updateRow(); // Inicial
            itemSelect.value = '';
        });

        taxInput.addEventListener('input', updateTotal);

        function updateTotal() {
            let subtotal = 0;
            itemsBody.querySelectorAll('tr').forEach(r => {
                const t = parseFloat(r.querySelector('.row-total').textContent.replace(/[$,]/g, '')) || 0;
                subtotal += t;
            });
            const taxRate = parseFloat(taxInput.value) || 0;
            const tax = subtotal * (taxRate / 100);
            const total = subtotal + tax;
            totalSpan.textContent = `$${total.toLocaleString('es-MX', {minimumFractionDigits:2})}`;
        }

        function clearForm() {
            itemsBody.innerHTML = '';
            folio.value = cliente.value = ciudad.value = telefono.value = email.value = notes.value = '';
            taxInput.value = 16;
            updateTotal();
        }

        window.generatePDF = () => {
            if (itemsBody.children.length === 0) return alert('Agrega ítems primero.');
            const doc = new jsPDF();
            const margin = 10;
            doc.setFillColor(13,17,32);
            doc.rect(0,0,210,40,'F');
            doc.setFontSize(16); doc.setTextColor(255);
            doc.text('TAE Transportación', 105, 20, {align:'center'});
            let y = 45;
            const date = new Date().toLocaleDateString('es-MX');
            doc.setFontSize(9); doc.setTextColor(51);
            doc.text(`Folio: ${folio.value || 'Sin folio'}`, margin, y);
            doc.text(`Fecha: ${date}`, 200 - margin, y, {align:'right'});
            y += 10;
            doc.setFontSize(14); doc.setTextColor(13,17,32);
            doc.text('Cotización', 105, y, {align:'center'});
            y += 15;
            doc.setFontSize(12);
            doc.text('Datos del Cliente', margin, y);
            y += 8; doc.setFontSize(9);
            doc.text(`Nombre: ${cliente.value || 'N/A'}`, margin, y); y += 5;
            doc.text(`Ciudad: ${ciudad.value || 'N/A'}`, margin, y); y += 5;
            doc.text(`Teléfono: ${telefono.value || 'N/A'}`, margin, y); y += 5;
            doc.text(`Email: ${email.value || 'N/A'}`, margin, y); y += 10;

            const tableData = Array.from(itemsBody.querySelectorAll('tr')).map(r => [
                r.querySelector('.qty').value,
                'Servicio de Transportación Ejecutiva',
                r.cells[2].textContent,
                `$${parseFloat(r.querySelector('.unit-price').value).toLocaleString('es-MX', {minimumFractionDigits:2})}`,
                r.querySelector('.row-total').textContent
            ]);

            doc.autoTable({
                head: [['Cant.', 'Concepto', 'Descripción', 'P. Unitario', 'Total']],
                body: tableData,
                startY: y,
                headStyles: {fillColor: [13,17,32], textColor:255},
                bodyStyles: {fontSize:8},
                columnStyles: {0:{cellWidth:15,halign:'center'},1:{cellWidth:40},2:{cellWidth:60},3:{cellWidth:30,halign:'right'},4:{cellWidth:30,halign:'right'}},
                margin
            });

            y = doc.lastAutoTable.finalY + 10;
            if (notes.value) {
                doc.setFontSize(10); doc.setTextColor(13,17,32);
                doc.text('Notas:', margin, y); y += 5;
                doc.setFontSize(8); doc.setTextColor(51);
                doc.text(doc.splitTextToSize(notes.value, 190 - 2*margin), margin, y);
                y += 20;
            }

            const totalNum = parseFloat(totalSpan.textContent.replace(/[$,]/g,'')) || 0;
            const taxRate = parseFloat(taxInput.value) || 0;
            const subtotal = totalNum / (1 + taxRate/100);
            const taxAmt = totalNum - subtotal;

            doc.setFontSize(10); doc.setTextColor(13,17,32);
            doc.text('Resumen:', margin, y);
            y += 5; doc.setFontSize(9); doc.setTextColor(51);
            doc.text(`Subtotal: $${subtotal.toLocaleString('es-MX', {minimumFractionDigits:2})}`, margin, y); y += 5;
            doc.text(`Impuestos (${taxRate}%): $${taxAmt.toLocaleString('es-MX', {minimumFractionDigits:2})}`, margin, y); y += 5;
            doc.setFontSize(10);
            doc.text(`Total: $${totalNum.toLocaleString('es-MX', {minimumFractionDigits:2})}`, margin, y);

            doc.save(`Cotizacion_${folio.value || 'TAE'}.pdf`);
        };
    </script>
</body>
</html>
